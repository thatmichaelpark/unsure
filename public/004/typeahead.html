<!doctype html>
<html ng-app="myApp">
	<head>
		<script src="javascripts/angular.js"></script>
		<script src="javascripts/ui-bootstrap-tpls-0.11.0.min.js"></script>
		<script>
			var app = angular.module('myApp', ['ui.bootstrap']);
			app.controller( 'TypeaheadCtrl', 
				function TypeaheadCtrl($scope, $http) {
					$scope.selected = undefined;
						$scope.states = ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Dakota', 'North Carolina', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'];
						
					getCustomers = function () {
						$http.get("/users/customers").success(function(data){
							$scope.customers = data;
						});
					};
					
					getCustomers();
					
					$scope.firstName = function(s) {
						var re = /(\w+)/g;
						var f = re.exec(s);
						if ( f ) {
							f = f[0];
							console.log( 'first: ' + f );
							return f;
						}
					}
					$scope.lastName = function(s) {
						var re = /(\w+)/g;
						re.exec(s)
						l = re.exec(s);
						if ( l ) {
							l = l[0];
							console.log( 'last: ' + l );
							return l;
						}
					}
					
					// Any function returning a promise object can be used to load values asynchronously
					$scope.getLocation = function(val) {
						return $http.get('http://maps.googleapis.com/maps/api/geocode/json', {
							params: {
								address: val,
								sensor: false
							}
						}).then(function(res){
							var addresses = [];
							angular.forEach(res.data.results, function(item){
								addresses.push(item.formatted_address);
							});
							return addresses;
						});
					};
				}
			);
		</script>
		<link href="stylesheets/bootstrap.css" rel="stylesheet">
	</head>
	<body>

		<div class='container-fluid' ng-controller="TypeaheadCtrl">

			<h4>Static arrays</h4>
			<pre>Model: {{selected | json}}</pre>
			<input type="text" ng-model="selected" typeahead="state for state in states | filter:$viewValue | limitTo:8" class="form-control">

			<h4>Asynchronous results</h4>
			<pre>Model: {{asyncSelected }}</pre>
			<input
				type="text" 
				ng-model="asyncSelected" 
				placeholder="Locations loaded via $http"
				typeahead="address for address in getLocation($viewValue)"
				typeahead-loading="loadingLocations"
				class="form-control"
			>
			<i ng-show="loadingLocations" class="glyphicon glyphicon-refresh"></i>

			<h4>Customers</h4>
			<pre>Model: {{customerSelected }}</pre>
			<input type="text" placeholder="Search Customers"
				ng-model="customerSelected"
				typeahead="c['First Name'] + c['Last Name'] as c['First Name'] + ' ' + c['Last Name'] + ' (' + c['Company Name'] + ')' for c in customers  | filter:firstName($viewValue) | filter:lastName($viewValue) | limitTo:10"
				typeahead-min-length='1'
				style="width:350px;"
				class="form-control">

		</div>
	</body>
</html>