<!doctype html>
<html ng-app="testApp">
	<head>
		<script src="http://code.angularjs.org/1.2.16/angular.js"></script>
		<script src="javascripts/angular-sanitize.js"></script>
		<script src="contenteditable.js"></script>
		<script>
			angular.module( 'testApp', ['ngSanitize'] )
			.controller( 'testCtrl', function ( $scope ) {
			
				$scope.data = [ {date: '???', by: 'Michael', note: 'first first first first first first first first first first first first first first first first first '},
				{date: '???', by: 'Michael', note: 'first'}, {date: '???', by: 'Michael', note: 'third'}  ];
				
				$scope.clickNew = function () {
					$scope.data.push( {date: '???', by: 'Michael', note: ''} );
				}
				$scope.clickOk = function () {
					for( var i=0; i<$scope.data.length; ++i ) {
						console.log( $scope.data[i].date + ', ' + $scope.data[i].by + ', ' + $scope.data[i].note );
					}
				}
				$scope.clickEdit = function ( s ) {
					s.edit = !s.edit;
				}
				$scope.blah = function ( s ) {
					while( true ) {
						var t = s.replace( '\n', '<br>' );
						if ( s == t ) break;
						s = t;
					}
					return t;
				}
			});
		</script>
	</head>
	<body ng-controller="testCtrl">
		<table ng-repeat="s in data track by $index" style="width:100%; border:solid black 1px" id="tab">
			<tr style="vertical-align:top">
				<td style="width:20%" id="d">{{s.date}}</td>
				<td style="width:20%" id="b">{{s.by}}</td>
				<td style="width:20%">
					<button ng-click="clickEdit(s)">Edit</button>
				</td>
				<td>
					<textarea ng-if="s.edit" style="width:80%; border: solid red 1px" ng-model="s.note">{{s.note}}</textarea>
					<div ng-if="!s.edit" style="width:80%; border: solid green 1px" ng-bind-html="blah(s.note)"></div>
				</td>
			</tr>
		</table>
		<hr>
		<button ng-click="clickNew()">New</button>
		<button ng-click="clickOk()">OK</button>
	</body>
</html>